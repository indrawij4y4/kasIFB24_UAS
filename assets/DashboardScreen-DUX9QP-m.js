import{j as e,a as P,d as h,W as R,f as w,g as y,h as T,i as _,R as A,P as q,k as M,A as K,m as S,U as B}from"./ui-ojUPcdkR.js";import{u as b}from"./useQuery-DrWLbDdI.js";import{u as $,c as d,a as p,p as z}from"./index-b6SL6hsZ.js";import{r as E,c as I}from"./vendor-S3JaNCHW.js";import{R as f}from"./config-4dfLyK49.js";function v({title:l,value:s,icon:n,type:a="neutral",trend:u}){const o={neutral:"bg-muted text-muted-foreground",income:"bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-500",expense:"bg-rose-50 dark:bg-rose-500/10 text-rose-600 dark:text-rose-500",balance:"bg-blue-50 dark:bg-blue-500/10 text-blue-600 dark:text-blue-500"},j={neutral:"text-foreground",income:"text-emerald-700 dark:text-emerald-400",expense:"text-rose-700 dark:text-rose-400",balance:"text-blue-700 dark:text-blue-400"};return e.jsxs("div",{className:"group relative p-6 rounded-3xl bg-card border border-border shadow-sm hover:shadow-[0_0_20px_rgba(30,58,138,0.1)] dark:hover:shadow-[0_0_20px_rgba(59,130,246,0.1)] transition-all duration-300 hover:scale-[1.02] h-full flex flex-col justify-between overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:d("w-12 h-12 rounded-2xl flex items-center justify-center transition-colors",o[a]),children:e.jsx(n,{className:"w-6 h-6 stroke-[2px]"})}),u&&e.jsx("span",{className:"text-[10px] font-bold px-2 py-1 bg-muted text-muted-foreground rounded-full border border-border",children:u})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-2",children:l}),e.jsx("h3",{className:d("text-2xl md:text-3xl font-extrabold tracking-tight",j[a]),children:s})]}),e.jsx("div",{className:d("absolute -right-6 -bottom-6 w-32 h-32 rounded-full opacity-10 blur-3xl transition-opacity group-hover:opacity-20",a==="balance"?"bg-gradient-to-br from-blue-400 to-blue-600":a==="income"?"bg-gradient-to-br from-emerald-400 to-emerald-600":a==="expense"?"bg-gradient-to-br from-rose-400 to-rose-600":"bg-gradient-to-br from-slate-200 to-slate-400")})]})}function U({unpaidWeeks:l,weeklyFee:s}){const n=s>0,a=l===0;return e.jsxs("div",{className:d("p-6 rounded-3xl border shadow-sm flex flex-col justify-center h-full relative overflow-hidden transition-all duration-300 hover:scale-[1.02] hover:shadow-md bg-card border-border"),children:[e.jsxs("div",{className:"flex items-start gap-5 relative z-10",children:[e.jsx("div",{className:d("w-14 h-14 rounded-2xl flex items-center justify-center shrink-0 transition-colors",n?a?"bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-500":"bg-rose-50 dark:bg-rose-500/10 text-rose-600 dark:text-rose-500":"bg-muted text-muted-foreground"),children:n?a?e.jsx(T,{className:"w-7 h-7 stroke-[2.5px]"}):e.jsx(M,{className:"w-7 h-7 stroke-[2.5px]"}):e.jsx(h,{className:"w-7 h-7 stroke-[2.5px]"})}),e.jsxs("div",{children:[e.jsx("p",{className:d("text-xs font-bold uppercase tracking-widest mb-2",n?a?"text-emerald-600 dark:text-emerald-500":"text-rose-600 dark:text-rose-500":"text-muted-foreground"),children:"Tagihan Kas Pribadi"}),e.jsx("h3",{className:d("text-xl font-black mb-1",n?a?"text-emerald-950 dark:text-emerald-50":"text-rose-950 dark:text-rose-50":"text-foreground"),children:n?a?"Lunas Semua":`Tunggakan ${l} Minggu`:"Belum Ada Tagihan"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:n?a?"Terima kasih, pembayaran aman!":`Tagihan: Rp ${(l*s).toLocaleString("id-ID")}`:"Menunggu pengaturan dari admin"})]})]}),e.jsx("div",{className:d("absolute top-0 right-0 w-32 h-32 rounded-full opacity-5 blur-3xl -translate-y-1/2 translate-x-1/2",n?a?"bg-emerald-500":"bg-rose-500":"bg-slate-400")})]})}function O({isOpen:l,onClose:s}){const n=I();return e.jsx(K,{children:l&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end justify-center",children:[e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(S.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},className:"bg-card w-full rounded-t-[40px] p-8 pb-12 shadow-2xl relative z-10 border-t border-border",children:[e.jsx("div",{className:"w-12 h-1.5 bg-muted rounded-full mx-auto mb-8"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>{n("/admin/in"),s()},className:"group p-5 bg-emerald-50 dark:bg-emerald-900/20 rounded-[2rem] flex flex-col items-center gap-3 active:scale-95 transition-all hover:bg-emerald-100 dark:hover:bg-emerald-900/40",children:[e.jsx("div",{className:"w-12 h-12 bg-background dark:bg-card rounded-2xl flex items-center justify-center text-emerald-500 dark:text-emerald-400 shadow-sm group-hover:scale-110 transition-transform",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-800 dark:text-emerald-300 tracking-wider",children:"Input Iuran"})]}),e.jsxs("button",{onClick:()=>{n("/arrears"),s()},className:"group p-5 bg-blue-50 dark:bg-blue-900/20 rounded-[2rem] flex flex-col items-center gap-3 active:scale-95 transition-all hover:bg-blue-100 dark:hover:bg-blue-900/40",children:[e.jsx("div",{className:"w-12 h-12 bg-background dark:bg-card rounded-2xl flex items-center justify-center text-blue-500 dark:text-blue-400 shadow-sm group-hover:scale-110 transition-transform",children:e.jsx(h,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-black uppercase text-blue-800 dark:text-blue-300 tracking-wider",children:"Quick Iuran"})]}),e.jsxs("button",{onClick:()=>{n("/admin/out"),s()},className:"group p-5 bg-rose-50 dark:bg-rose-900/20 rounded-[2rem] flex flex-col items-center gap-3 active:scale-95 transition-all hover:bg-rose-100 dark:hover:bg-rose-900/40 col-span-2",children:[e.jsx("div",{className:"w-12 h-12 bg-background dark:bg-card rounded-2xl flex items-center justify-center text-rose-500 dark:text-rose-400 shadow-sm group-hover:scale-110 transition-transform",children:e.jsx(A,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-black uppercase text-rose-800 dark:text-rose-300 tracking-wider",children:"Belanja"})]})]}),e.jsx("button",{onClick:s,className:"w-full mt-10 py-4 text-muted-foreground font-bold uppercase text-xs hover:text-foreground transition-colors",children:"Tutup Menu"})]})]})})}function G(){const{user:l}=$(),s=l?.role==="admin",[n,a]=E.useState(!1),u=I(),{data:o,isLoading:j}=b({queryKey:["dashboardStats"],queryFn:p.getStats,staleTime:1e3,refetchInterval:f}),m=new Date().getMonth()+1,x=new Date().getFullYear(),{data:N}=b({queryKey:["students",m,x],queryFn:()=>p.getStudents(m,x),staleTime:1e3,refetchInterval:f}),{data:c}=b({queryKey:["settings",m,x],queryFn:()=>p.getSettings(m,x),staleTime:30*1e3,refetchInterval:30*1e3}),{data:C}=b({queryKey:["recentTransactions"],queryFn:()=>p.getTransactions(),staleTime:1e3,refetchInterval:f}),{data:D}=b({queryKey:["recentIncome",m,x],queryFn:()=>z.getList(m,x),staleTime:1e3,refetchInterval:f}),k=(()=>{const r=(D||[]).map(t=>({id:`income-${t.id}`,title:t.nama,date:t.tanggal||"-",amount:t.nominal,type:"income",week:t.minggu_ke,createdAt:t.created_at})),i=(C||[]).map(t=>({id:`expense-${t.id}`,title:t.title,date:t.date,amount:t.amount,type:"expense",createdAt:t.createdAt}));return[...r,...i].sort((t,g)=>{const F=new Date(t.createdAt||t.date).getTime();return new Date(g.createdAt||g.date).getTime()-F}).slice(0,3)})(),L=(()=>{if(!N||!l||!c)return 0;const r=N.find(g=>g.nim===l.nim);if(!r)return 0;const i=c.weeklyFee;let t=0;return r.m1<i&&t++,r.m2<i&&t++,r.m3<i&&t++,r.m4<i&&t++,c.weeksPerMonth===5&&r.m5<i&&t++,t})();return j||!o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"p-4 md:p-8 pb-32 animate-fadeIn max-w-7xl mx-auto font-sans",children:[e.jsx("div",{className:"flex justify-between items-start mb-10",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[20px] flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-blue-500/20",children:l?.name?.[0]}),e.jsxs("div",{children:[e.jsx("span",{className:d("text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full mb-2 inline-block border",s?"bg-rose-50 text-rose-500 border-rose-100":"bg-blue-50 text-blue-500 border-blue-100"),children:s?"Bendahara":"Anggota"}),e.jsxs("h3",{className:"font-bold text-foreground text-xl leading-none",children:["Halo, ",l?.name?.split(" ")[0]," ðŸ‘‹"]}),e.jsxs("div",{className:"mt-2 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 text-blue-700 dark:text-blue-300 text-xs font-semibold shadow-sm",children:[e.jsx(h,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["Iuran ",new Date().toLocaleString("id-ID",{month:"long"}),": Rp ",(c?.weeklyFee??0).toLocaleString("id-ID")," / minggu"]})]})]})]})}),e.jsxs("div",{className:"flex flex-nowrap overflow-x-auto snap-x snap-mandatory gap-4 -mx-4 px-4 pb-4 md:grid md:grid-cols-3 md:gap-6 md:pb-0 md:mx-0 md:px-0 md:overflow-visible scrollbar-hide mb-8",children:[e.jsx("div",{className:"min-w-[85vw] md:min-w-0 md:col-span-1 snap-center h-full",children:e.jsx(v,{title:"Saldo Kas",value:`Rp ${o.balance.toLocaleString("id-ID")}`,icon:R,type:"balance"})}),e.jsx("div",{className:"min-w-[85vw] md:min-w-0 md:col-span-1 snap-center h-full",children:e.jsx(v,{title:"Pemasukan (Bln)",value:`Rp ${o.incomeThisMonth?.toLocaleString("id-ID")??0}`,icon:w,type:"income"})}),e.jsx("div",{className:"min-w-[85vw] md:min-w-0 md:col-span-1 snap-center h-full",children:e.jsx(v,{title:"Pengeluaran (Bln)",value:`Rp ${o.expenseThisMonth?.toLocaleString("id-ID")??0}`,icon:y,type:"expense"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 items-stretch",children:[e.jsx("div",{className:"h-full",children:e.jsx(U,{unpaidWeeks:L,weeklyFee:c?.weeklyFee??0})}),e.jsx("div",{className:"h-full",children:s?e.jsxs("div",{onClick:()=>u("/arrears"),className:"group h-full bg-card p-6 rounded-3xl border border-border shadow-sm flex items-center justify-between cursor-pointer transition-all duration-300 hover:scale-[1.02] hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:d("w-14 h-14 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform",c?.weeklyFee?o.arrearsCount===0?"bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500":"bg-rose-50 dark:bg-rose-500/10 text-rose-500":"bg-muted text-muted-foreground"),children:c?.weeklyFee?o.arrearsCount===0?e.jsx(T,{className:"w-7 h-7"}):e.jsx(h,{className:"w-7 h-7"}):e.jsx(h,{className:"w-7 h-7"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-foreground text-lg mb-1",children:c?.weeklyFee?o.arrearsCount===0?"Lunas Semua ðŸŽ‰":"Cek Tunggakan":"Atur Kas Dulu"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:c?.weeklyFee?o.arrearsCount===0?e.jsx("span",{className:"text-emerald-500 font-bold",children:"Semua anggota sudah lunas!"}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-rose-500 font-bold",children:[o.arrearsCount," Siswa"]})," belum lunas minggu ini"]}):e.jsx("span",{className:"text-muted-foreground",children:"Silakan atur pengaturan kas terlebih dahulu"})})]})]}),e.jsx("div",{className:"p-2 rounded-full bg-muted text-muted-foreground group-hover:bg-accent group-hover:text-accent-foreground transition-colors",children:e.jsx(w,{className:"w-5 h-5 rotate-90"})})]}):e.jsx("div",{className:"h-full bg-muted/50 p-6 rounded-3xl border border-border flex flex-col justify-center items-center text-center",children:e.jsx("p",{className:"text-xs text-muted-foreground font-medium leading-relaxed max-w-xs",children:'"Transparansi adalah fondasi kepercayaan. Kami berkomitmen untuk pengelolaan kas yang terbuka dan akuntabel."'})})})]}),e.jsxs("div",{className:"bg-card p-6 md:p-8 rounded-[2.5rem] border border-border shadow-sm mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("h4",{className:"font-black text-muted-foreground text-xs tracking-widest uppercase flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),"Aktivitas Terbaru"]}),e.jsx("button",{onClick:()=>u("/report"),className:"text-primary text-xs font-bold hover:underline bg-primary/10 px-3 py-1.5 rounded-full transition-colors hover:bg-primary/20",children:"Lihat Semua"})]}),e.jsx("div",{className:"space-y-4",children:k&&k.length>0?k.map(r=>{let i=r.date;try{const t=new Date(r.date);isNaN(t.getTime())||(i=t.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}))}catch{}return e.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-2xl hover:bg-accent/50 dark:hover:bg-accent/20 transition-colors border border-transparent hover:border-border",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:d("w-12 h-12 rounded-2xl flex items-center justify-center transition-transform group-hover:scale-110",r.type==="expense"?"bg-rose-50 dark:bg-rose-500/10 text-rose-500":"bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500"),children:r.type==="expense"?e.jsx(y,{className:"w-5 h-5"}):e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-foreground mb-0.5",children:[r.title,r.type==="income"&&r.week&&e.jsxs("span",{className:"ml-1.5 text-[10px] text-emerald-600 dark:text-emerald-400 font-medium",children:["M",r.week]})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-medium bg-muted px-2 py-0.5 rounded-md w-fit",children:i})]})]}),e.jsxs("p",{className:d("text-sm font-black",r.type==="expense"?"text-rose-500":"text-emerald-500"),children:[r.type==="expense"?"-":"+"," Rp ",r.amount.toLocaleString("id-ID")]})]},r.id)}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center mb-4",children:e.jsx(A,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-sm font-bold text-muted-foreground",children:"Belum ada aktivitas"}),e.jsx("p",{className:"text-xs text-muted-foreground/50 mt-1",children:"Transaksi terbaru akan muncul di sini"})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-24 right-4 md:bottom-12 md:right-12 w-14 h-14 md:w-16 md:h-16 bg-blue-600 dark:bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center active:scale-95 transition-all z-40 border-[4px] border-white/20 hover:scale-110 hover:shadow-[0_0_30px_rgba(37,99,235,0.6)]",children:e.jsx(q,{className:"w-6 h-6 md:w-7 md:h-7 stroke-[3px]"})}),e.jsx(O,{isOpen:n,onClose:()=>a(!1)})]})]})}export{G as DashboardScreen};
