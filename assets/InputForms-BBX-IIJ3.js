import{j as e,y as q,a as G}from"./ui-DDsedppd.js";import{c as A,r as t}from"./vendor-S3JaNCHW.js";import{u as j}from"./useQuery-DkVTJIeT.js";import{b as F,g as z,I as O,B as R,p as X,d as V,f as H,a as L}from"./index-rjKn95qZ.js";import{u as K}from"./useMutation-D3hKlEL6.js";import{S as w}from"./Select-fF-gD4rQ.js";import{M as g}from"./Modal-C_4vaiPk.js";import{R as Z}from"./config-4dfLyK49.js";const ee=()=>new Date().getMonth()+1,ae=()=>new Date().getFullYear(),E=1e7,T="10.000.000",B=s=>{const o=typeof s=="string"?s.replace(/\D/g,""):s.toString();return o?parseInt(o).toLocaleString("id-ID"):""},_=s=>s.replace(/\D/g,""),ne=()=>{const s=new Date,o=new Date(s.getFullYear(),s.getMonth(),1),b=s.getDate(),u=o.getDay();return Math.ceil((b+u)/7)};function ce(){const s=A(),o=F(),[b,u]=t.useState(!1),[M,f]=t.useState(!1),[h,r]=t.useState({open:!1,message:""}),[i,k]=t.useState(""),[l,N]=t.useState(ee().toString()),[d]=t.useState(ae().toString()),[c,x]=t.useState(ne().toString()),[n,y]=t.useState(""),{data:S,isLoading:Q}=j({queryKey:["users"],queryFn:H.getAll}),{data:p}=j({queryKey:["settings",l,d],queryFn:()=>L.getSettings(parseInt(l),parseInt(d)),staleTime:300*1e3}),{data:I}=j({queryKey:["studentsData",l,d],queryFn:()=>L.getStudents(parseInt(l),parseInt(d)),enabled:!!i}),W=a=>{if(!I||!i)return!1;const v=I.find(U=>U.id.toString()===i);if(!v)return!1;const J=`m${a}`;return(v[J]||0)>0},P=z(parseInt(d),parseInt(l)-1),m=Array.from({length:P},(a,v)=>v+1).map(a=>({label:`Minggu ${a}`,value:a.toString(),disabled:W(a)})).filter(a=>!a.disabled);t.useEffect(()=>{S&&S.length>0&&!i&&k(S[0].id.toString())},[S,i]),t.useEffect(()=>{m.length>0?m.find(a=>a.value===c)||x(m[0].value):x("-"),p?.weeklyFee&&y(p.weeklyFee.toString())},[p?.weeklyFee,l,d,I,i,m,c]);const C=K({mutationFn:async()=>X.store({user_id:parseInt(i),bulan:parseInt(l),tahun:parseInt(d),minggu_ke:parseInt(c),nominal:parseInt(n)}),onSuccess:()=>{o.invalidateQueries({queryKey:["students"]}),o.invalidateQueries({queryKey:["dashboardStats"]}),o.invalidateQueries({queryKey:["arrears"]}),u(!1),f(!0)},onError:a=>{u(!1),r({open:!0,message:a.message||"Terjadi kesalahan saat menyimpan data. Silakan coba lagi."})}}),D=p?.is_configured!==!1,Y=()=>{if(!i||!n){r({open:!0,message:"Lengkapi semua field!"});return}if(p?.is_configured===!1){r({open:!0,message:"Bulan ini belum dikonfigurasi oleh Admin. Silakan hubungi admin untuk melakukan konfigurasi keuangan di menu Pengaturan."});return}if((!c||c==="-")&&m.length===0){r({open:!0,message:"Mahasiswa ini sudah lunas untuk bulan ini."});return}const a=parseInt(n);if(a>E){r({open:!0,message:`Nominal melebihi batas maksimum. Maksimum input yang diizinkan adalah Rp ${T}. Silakan masukkan nominal yang lebih kecil.`});return}if(a<=0){r({open:!0,message:"Nominal harus lebih dari Rp 0. Silakan masukkan nominal yang valid."});return}u(!0)},$=[{label:"Januari",value:"1"},{label:"Februari",value:"2"},{label:"Maret",value:"3"},{label:"April",value:"4"},{label:"Mei",value:"5"},{label:"Juni",value:"6"},{label:"Juli",value:"7"},{label:"Agustus",value:"8"},{label:"September",value:"9"},{label:"Oktober",value:"10"},{label:"November",value:"11"},{label:"Desember",value:"12"}];return e.jsxs("div",{className:"p-4 md:p-6 bg-background min-h-screen animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>s("/"),className:"w-10 h-10 bg-card rounded-xl shadow-sm border border-border flex items-center justify-center text-muted-foreground active:scale-95 transition-transform",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Input Iuran"})]}),Q?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(G,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"bg-card p-6 rounded-3xl shadow-sm space-y-4 border border-border",children:[p?.is_configured===!1&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/20 text-amber-600 p-4 rounded-xl text-sm font-medium flex items-center gap-2",children:e.jsx("span",{children:"⚠️ Bulan ini belum dikonfigurasi. Tidak dapat menginput data."})}),e.jsx(w,{label:"Nama Mahasiswa",value:i,onChange:a=>k(a.target.value),options:S?.map(a=>({label:a.nama,value:a.id.toString()}))||[]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(w,{label:"Bulan",value:l,onChange:a=>N(a.target.value),options:$}),e.jsx(w,{label:"Minggu Ke",value:c,onChange:a=>x(a.target.value),options:m.length>0?m:[{label:"Lunas Semua",value:"-"}],disabled:m.length===0||!D})]}),e.jsx(O,{label:"Nominal (Rp)",type:"text",inputMode:"numeric",value:B(n),onChange:a=>y(_(a.target.value)),placeholder:"10.000",disabled:!D}),e.jsx(R,{onClick:Y,variant:"success",className:"w-full",isLoading:C.isPending,disabled:!D,children:"Simpan Iuran"})]}),e.jsx(g,{isOpen:b,onClose:()=>u(!1),onConfirm:()=>C.mutate(),title:"Konfirmasi",description:"Simpan data iuran ke sistem?",type:"confirm",confirmLabel:C.isPending?"Menyimpan...":"Ya, Simpan"}),e.jsx(g,{isOpen:M,onClose:()=>{f(!1),s("/")},title:"Berhasil",description:"Data iuran berhasil disimpan!",type:"success"}),e.jsx(g,{isOpen:h.open,onClose:()=>r({open:!1,message:""}),title:"Gagal",description:h.message,type:"error"})]})}function me(){const s=A(),o=F(),[b,u]=t.useState(!1),[M,f]=t.useState(!1),[h,r]=t.useState({open:!1,message:""}),[i,k]=t.useState(""),[l,N]=t.useState(""),{data:d}=j({queryKey:["dashboardStats"],queryFn:L.getStats,staleTime:60*1e3,refetchInterval:Z}),c=K({mutationFn:async()=>{const n=new FormData;return n.append("judul",i),n.append("nominal",l),n.append("tanggal",new Date().toISOString().split("T")[0]),V.store(n)},onSuccess:()=>{o.invalidateQueries({queryKey:["transactions"]}),o.invalidateQueries({queryKey:["dashboardStats"]}),u(!1),f(!0)},onError:n=>{u(!1),r({open:!0,message:n.message||"Gagal menyimpan data belanja."})}}),x=()=>{if(!i||!l){r({open:!0,message:"Lengkapi judul dan nominal!"});return}const n=parseInt(l),y=d?.balance||0;if(n>E){r({open:!0,message:`Nominal melebihi batas maksimum. Maksimum input yang diizinkan adalah Rp ${T}. Silakan masukkan nominal yang lebih kecil.`});return}if(n<=0){r({open:!0,message:"Nominal harus lebih dari Rp 0. Silakan masukkan nominal yang valid."});return}if(n>y){r({open:!0,message:`Saldo tidak cukup! Saldo saat ini: Rp ${y.toLocaleString("id-ID")}, nominal belanja: Rp ${n.toLocaleString("id-ID")}.`});return}u(!0)};return e.jsxs("div",{className:"p-4 md:p-6 bg-background min-h-screen animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>s("/"),className:"w-10 h-10 bg-card rounded-xl shadow-sm border border-border flex items-center justify-center text-muted-foreground active:scale-95 transition-transform",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Input Belanja"})]}),e.jsxs("div",{className:"bg-card p-6 rounded-3xl shadow-sm space-y-4 border border-border",children:[d&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 mb-2",children:[e.jsx("p",{className:"text-xs font-bold text-blue-600 uppercase mb-1",children:"Saldo Tersedia"}),e.jsxs("p",{className:"text-lg font-black text-blue-800",children:["Rp ",(d.balance||0).toLocaleString("id-ID")]})]}),e.jsx(O,{label:"Kebutuhan / Judul",value:i,onChange:n=>k(n.target.value)}),e.jsx(O,{label:"Nominal (Rp)",type:"text",inputMode:"numeric",value:B(l),onChange:n=>N(_(n.target.value)),placeholder:"10.000"}),e.jsx(R,{onClick:x,variant:"danger",className:"w-full",isLoading:c.isPending,children:"Simpan Belanja"})]}),e.jsx(g,{isOpen:b,onClose:()=>u(!1),onConfirm:()=>c.mutate(),title:"Konfirmasi",description:"Simpan data belanja ke sistem?",type:"confirm",confirmLabel:c.isPending?"Menyimpan...":"Ya, Simpan"}),e.jsx(g,{isOpen:M,onClose:()=>{f(!1),s("/")},title:"Berhasil",description:"Data belanja berhasil disimpan!",type:"success"}),e.jsx(g,{isOpen:h.open,onClose:()=>r({open:!1,message:""}),title:"Gagal",description:h.message,type:"error"})]})}export{ce as InputInScreen,me as InputOutScreen};
