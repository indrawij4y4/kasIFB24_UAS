import{j as e,z as X,X as Z,o as ee,B as ne,K as O,S as ke,L as Ce,J as Se,l as Me,a as $,h as Pe,M as Ie,N as Re,e as se,n as Fe,O as ae,Q as Oe}from"./ui-ojUPcdkR.js";import{r as a}from"./vendor-S3JaNCHW.js";import{u as De}from"./useQuery-DrWLbDdI.js";import{c as v,u as te,b as Le,g as Ae,f as Ke,I as C,B as S,a as D,h as T}from"./index-b6SL6hsZ.js";import{u as Be}from"./useMutation-CvMS9LLC.js";import{M}from"./Modal-ChpNS6wC.js";function Ge({options:r,value:m,onChange:d,label:b,placeholder:P="Cari...",className:l,disabled:j=!1}){const[u,x]=a.useState(!1),[g,h]=a.useState(""),w=a.useRef(null),N=a.useMemo(()=>{if(!g)return r;const t=g.toLowerCase();return r.filter(p=>p.label.toLowerCase().includes(t))},[r,g]),y=a.useMemo(()=>r.find(t=>t.value===m)?.label||"",[r,m]);a.useEffect(()=>{const t=p=>{p.key==="Escape"&&(x(!1),h(""))};return u&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[u]),a.useEffect(()=>{u&&w.current&&setTimeout(()=>w.current?.focus(),100)},[u]);const I=t=>{d(t),x(!1),h("")},A=t=>{t.stopPropagation(),d(""),h("")},i=()=>{x(!1),h("")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:v("relative",l),children:e.jsxs("button",{type:"button",onClick:()=>!j&&x(!0),disabled:j,className:v("w-full flex items-center gap-3 rounded-xl border-2 bg-background px-4 py-4 text-left font-medium transition-all min-h-[56px]","border-border hover:border-primary/50 hover:bg-muted/30",j&&"opacity-50 cursor-not-allowed","focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"),children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(X,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-muted-foreground font-medium mb-0.5",children:b}),e.jsx("div",{className:v("text-base truncate",y?"text-foreground font-semibold":"text-muted-foreground"),children:y||"Klik untuk memilih..."})]}),m&&e.jsx("span",{role:"button",onClick:A,className:"p-2 hover:bg-muted rounded-lg transition-colors flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-muted-foreground hover:text-foreground"})})]})}),u&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:i}),e.jsxs("div",{className:"relative w-full max-w-md bg-card rounded-3xl shadow-2xl border border-border overflow-hidden animate-in zoom-in-95 fade-in duration-200",children:[e.jsxs("div",{className:"p-5 border-b border-border bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-foreground",children:b}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.length," mahasiswa tersedia"]})]})]}),e.jsx("button",{type:"button",onClick:i,className:"p-2 hover:bg-muted rounded-xl transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx("input",{ref:w,type:"text",className:"w-full bg-background text-foreground border-2 border-border rounded-xl pl-12 pr-4 py-3 text-base font-medium outline-none focus:border-primary transition-colors placeholder:text-muted-foreground",placeholder:P,value:g,onChange:t=>h(t.target.value)})]})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto p-3",children:N.length>0?e.jsx("div",{className:"space-y-1",children:N.map(t=>e.jsxs("button",{type:"button",onClick:()=>I(t.value),className:v("w-full text-left px-4 py-3.5 rounded-xl text-sm font-medium transition-all flex items-center justify-between gap-3",m===t.value?"bg-primary text-primary-foreground shadow-lg":"hover:bg-muted text-foreground"),children:[e.jsx("span",{className:"truncate",children:t.label}),m===t.value&&e.jsx(ne,{className:"w-5 h-5 flex-shrink-0"})]},t.value))}):e.jsxs("div",{className:"px-4 py-12 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(ee,{className:"w-6 h-6 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground text-sm font-medium",children:"Tidak ada hasil ditemukan"}),e.jsx("p",{className:"text-muted-foreground/60 text-xs mt-1",children:"Coba kata kunci lain"})]})})]})]})]})}const re=r=>(typeof r=="string"?r.replace(/\D/g,""):r.toString()).replace(/\B(?=(\d{3})+(?!\d))/g,"."),Q=r=>r.replace(/\./g,""),L=[{label:"Januari",value:"1"},{label:"Februari",value:"2"},{label:"Maret",value:"3"},{label:"April",value:"4"},{label:"Mei",value:"5"},{label:"Juni",value:"6"},{label:"Juli",value:"7"},{label:"Agustus",value:"8"},{label:"September",value:"9"},{label:"Oktober",value:"10"},{label:"November",value:"11"},{label:"Desember",value:"12"}],f=new Date().getFullYear(),Ve=()=>{const{user:r}=te(),m=Le(),d=r?.role==="admin",[b,P]=a.useState({isOpen:!1,type:"success",title:"",message:""}),l=(s,n,o)=>{P({isOpen:!0,type:s,title:n,message:o})},[j,u]=a.useState(""),[x,g]=a.useState(""),[h,w]=a.useState(""),[N,y]=a.useState(!1),[I,A]=a.useState([]),[i,t]=a.useState(""),[p,V]=a.useState(!1),[le,K]=a.useState(!1),[B,J]=a.useState(""),[de,Y]=a.useState(!1),[c,oe]=a.useState((new Date().getMonth()+1).toString()),[k,z]=a.useState(""),[ie,G]=a.useState(new Set),[ce,E]=a.useState(!1),[me,q]=a.useState(!1),{data:U,isLoading:W}=De({queryKey:["settings",c,f],queryFn:()=>D.getSettings(parseInt(c),f),staleTime:300*1e3,enabled:d});a.useEffect(()=>{if(!d)return;G(new Set),(async()=>{const n=new Set;for(let o=1;o<=12;o++)try{const F=await D.getSettings(o,f);(F.is_configured||F.weeklyFee>0&&!F.hasOwnProperty("is_configured"))&&n.add(o.toString())}catch{}G(n)})()},[d]),a.useEffect(()=>{U&&z(re(U.weeklyFee))},[U]);const ue=s=>{const n=Q(s.target.value);(n===""||/^\d+$/.test(n))&&z(re(n))},_=Ae(f,parseInt(c)-1),R=Be({mutationFn:D.updateSettings,onSuccess:()=>{m.invalidateQueries({queryKey:["settings"]}),l("success","Berhasil",`Pengaturan untuk ${L[parseInt(c)-1].label} ${f} berhasil disimpan!`)},onError:s=>{l("error","Gagal",s.message||"Gagal menyimpan pengaturan")}});a.useEffect(()=>{d&&xe()},[d]);const xe=async()=>{try{const s=await Ke.getAll();A(s)}catch(s){console.error("Failed to load users",s)}},he=async s=>{E(!1);const n=parseInt(Q(k));R.mutate({weeklyFee:n,weeksPerMonth:_,month:parseInt(c),year:f}),G(o=>new Set(o).add(c))},fe=s=>{if(s.preventDefault(),!k||Q(k)==="0"){l("error","Validasi Gagal","Nominal iuran tidak boleh kosong atau nol");return}E(!0)},be=async s=>{if(s.preventDefault(),x!==h){l("error","Gagal","Password baru tidak cocok!");return}y(!0);try{await T.changePassword(j,x),l("success","Berhasil","Password berhasil diubah!"),u(""),g(""),w("")}catch(n){l("error","Gagal",n.message||"Gagal mengubah password")}finally{y(!1)}},ge=async()=>{if(i){q(!1),V(!0);try{await T.resetPassword(parseInt(i)),l("success","Berhasil","Password member berhasil direset ke default (NIM)!"),t("")}catch(s){l("error","Gagal",s.message||"Gagal mereset password")}finally{V(!1)}}},pe=()=>{if(!i){l("error","Validasi Gagal","Pilih mahasiswa terlebih dahulu");return}q(!0)},je=()=>{J(""),K(!0)},we=async()=>{if(!B){l("error","Validasi Gagal","Masukkan password anda untuk konfirmasi");return}Y(!0);try{await T.login(r.nim,B),await D.resetAllData(),K(!1),l("success","Reset Berhasil","Semua data aplikasi berhasil direset!")}catch{l("error","Gagal","Password salah! Gagal mereset data.")}finally{Y(!1)}},[ve,H]=a.useState(!1),{logout:Ne}=te(),ye=()=>{Ne()};return r?e.jsx("div",{className:"min-h-screen animate-fadeIn pb-28 md:pb-12",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 md:px-6 py-6 md:py-8 space-y-6",children:[e.jsx(M,{isOpen:b.isOpen,onClose:()=>P(s=>({...s,isOpen:!1})),title:b.title,description:b.message,type:b.type}),e.jsx(M,{isOpen:le,onClose:()=>K(!1),onConfirm:we,title:"Konfirmasi Reset Data",description:"Tindakan ini sangat berbahaya dan tidak dapat dibatalkan. Masukkan password anda untuk melanjutkan.",type:"confirm",confirmLabel:de?"Memverifikasi...":"Konfirmasi & Hapus",children:e.jsx("div",{className:"mt-4 text-left",children:e.jsx(C,{type:"password",label:"Password Admin",placeholder:"Masukkan password anda",value:B,onChange:s=>J(s.target.value),required:!0,autoFocus:!0,rightIcon:e.jsx(O,{className:"w-4 h-4 text-muted-foreground"})})})}),e.jsx(M,{isOpen:ce,onClose:()=>E(!1),onConfirm:()=>he(),title:"Konfirmasi Perubahan",description:`Apakah anda yakin ingin mengatur iuran mingguan menjadi Rp ${k} untuk periode ${L[parseInt(c)-1]?.label} ${f}?`,type:"confirm",confirmLabel:R.isPending?"Menyimpan...":"Ya, Simpan"}),e.jsx(M,{isOpen:me,onClose:()=>q(!1),onConfirm:ge,title:"Reset Password Member?",description:`Password ${I.find(s=>s.id.toString()===i)?.nama||"member"} akan direset ke default (NIM). Tindakan ini tidak dapat dibatalkan.`,type:"confirm",confirmLabel:p?"Mereset...":"Ya, Reset Password"}),e.jsx(M,{isOpen:ve,onClose:()=>H(!1),onConfirm:ye,title:"Konfirmasi Logout",description:"Apakah anda yakin ingin keluar dari aplikasi?",type:"confirm",confirmLabel:"Ya, Keluar"}),e.jsxs("div",{className:"flex items-center justify-between pb-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-500/25",children:e.jsx(ke,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold tracking-tight text-foreground",children:"Pengaturan"}),e.jsx("p",{className:"text-muted-foreground text-sm font-medium",children:"Kelola akun"})]})]}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>H(!0),className:"text-muted-foreground hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/10 rounded-xl md:hidden",title:"Keluar Aplikasi",children:e.jsx(Ce,{className:"w-6 h-6"})})]}),d&&e.jsxs("div",{className:"bg-card rounded-3xl border border-border overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-5 md:p-6 border-b border-border bg-muted/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-emerald-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-foreground",children:"Konfigurasi Kas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Atur iuran mingguan per periode"})]})]})}),e.jsx("div",{className:"p-5 md:p-6",children:e.jsxs("form",{onSubmit:fe,className:"space-y-5",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wider mb-3 block",children:"Pilih Bulan"}),e.jsx("div",{className:"flex overflow-x-auto pb-3 gap-2 scrollbar-hide -mx-1 px-1 snap-x",children:L.map(s=>{const n=ie.has(s.value),o=c===s.value;return e.jsxs("button",{type:"button",onClick:()=>oe(s.value),className:v("flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-bold transition-all border snap-center flex items-center gap-2",o?"bg-emerald-500 text-white border-emerald-500 shadow-lg shadow-emerald-500/30 scale-105":n?"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30 hover:bg-emerald-500/20":"bg-muted/50 text-muted-foreground border-border hover:border-emerald-500/50 hover:bg-muted"),children:[n&&e.jsx(ne,{className:v("w-4 h-4",o?"text-white":"text-emerald-500")}),s.label]},s.value)})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{type:"text",inputMode:"numeric",label:"Iuran Mingguan (Rp)",leftIcon:e.jsx("span",{className:"font-bold text-sm text-emerald-500",children:"Rp"}),value:k,onChange:ue,placeholder:"Contoh: 10.000",required:!0,disabled:W}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-2xl border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-muted-foreground font-medium flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Jumlah Minggu:"]}),e.jsxs("span",{className:"font-bold text-emerald-500",children:[_," Minggu"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground leading-relaxed",children:["Pengaturan ini berlaku untuk ",e.jsxs("strong",{className:"text-foreground",children:[L[parseInt(c)-1].label," ",f]}),". Periode lain tidak akan terpengaruh."]})]})]}),e.jsx(S,{type:"submit",disabled:R.isPending||W,className:"bg-emerald-600 hover:bg-emerald-700 font-bold h-11 px-6 shadow-lg shadow-emerald-500/20 w-full md:w-auto",children:R.isPending?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin mr-2"})," Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"})," Simpan Konfigurasi"]})})]})})]}),d&&e.jsxs("div",{className:"bg-card rounded-3xl border border-border overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-5 md:p-6 border-b border-border bg-muted/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/10 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-foreground",children:"Reset Password Member"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reset password mahasiswa ke default (NIM)"})]})]})}),e.jsx("div",{className:"p-5 md:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ge,{label:"Pilih Mahasiswa",value:i,onChange:t,options:I.map(s=>({value:s.id.toString(),label:`${s.nim} - ${s.nama}`})),placeholder:"Cari nama atau NIM..."}),e.jsx(S,{type:"button",variant:"secondary",onClick:pe,disabled:!i||p,className:"font-bold h-11 px-6 border border-orange-500/30 hover:bg-orange-500/10 hover:text-orange-500",children:p?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin mr-2"})," Mereset..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"})," Reset ke Default"]})})]})})]}),e.jsxs("div",{className:"bg-card rounded-3xl border border-border overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-5 md:p-6 border-b border-border bg-muted/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-foreground",children:"Ganti Password"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kelola keamanan akun anda"})]})]})}),e.jsx("div",{className:"p-5 md:p-6",children:e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsx(C,{type:"password",label:"Password Saat Ini",placeholder:"Masukkan password saat ini",value:j,onChange:s=>u(s.target.value),required:!0,leftIcon:e.jsx(se,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(C,{type:"password",label:"Password Baru",placeholder:"Masukkan password baru",value:x,onChange:s=>g(s.target.value),required:!0,leftIcon:e.jsx(O,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx(C,{type:"password",label:"Konfirmasi Password",placeholder:"Ulangi password baru",value:h,onChange:s=>w(s.target.value),required:!0,leftIcon:e.jsx(O,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(S,{type:"submit",disabled:N,className:"bg-blue-600 hover:bg-blue-700 font-bold h-11 px-6 shadow-lg shadow-blue-500/20",children:N?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin mr-2"})," Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2"})," Update Password"]})})]})})]}),d&&e.jsxs("div",{className:"bg-card rounded-3xl border border-border border-l-4 border-l-rose-500 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-5 md:p-6 border-b border-border bg-rose-500/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-rose-500/10 flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-rose-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-rose-600 dark:text-rose-400",children:"Danger Zone"}),e.jsx("p",{className:"text-xs text-rose-500/80",children:"Tindakan berbahaya dan permanen"})]})]})}),e.jsx("div",{className:"p-5 md:p-6 bg-rose-500/5",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-bold text-foreground mb-1 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-rose-500"}),"Reset Total Data"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Menghapus seluruh riwayat transaksi. Data akun tidak akan dihapus."})]}),e.jsxs(S,{type:"button",variant:"danger",onClick:je,className:"bg-rose-600 hover:bg-rose-700 text-white h-11 px-6 font-bold shadow-lg shadow-rose-500/20 w-full md:w-auto",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Reset Data"]})]})})]}),e.jsx("div",{className:"bg-gradient-to-br from-violet-500/10 via-card to-indigo-500/10 rounded-3xl border border-border overflow-hidden shadow-sm",children:e.jsxs("div",{className:"p-8 md:p-10 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-violet-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mx-auto mb-5 shadow-lg shadow-violet-500/25",children:e.jsx(Oe,{className:"w-8 h-8"})}),e.jsx("h2",{className:"text-xl font-black text-foreground mb-2",children:"Kelas IFB24 Finance"}),e.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-full bg-violet-500/10 border border-violet-500/20 text-violet-400 text-xs font-bold uppercase tracking-wider mb-4",children:"v1.0.0 Public Beta"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto mb-4",children:"Platform manajemen keuangan kelas untuk transparansi dan akuntabilitas."}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Dibuat oleh ",e.jsx("span",{className:"font-bold text-foreground",children:"Indra IFB 2026"})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-border",children:e.jsx("span",{className:"text-xs text-muted-foreground/50",children:"2026 Â© All Rights Reserved"})})]})})]})}):null};export{Ve as SettingsScreen};
