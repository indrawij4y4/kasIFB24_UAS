import{j as e,y as L,a as U}from"./ui-ojUPcdkR.js";import{c as q,r as n}from"./vendor-S3JaNCHW.js";import{u as k}from"./useQuery-DrWLbDdI.js";import{b as A,g as G,I as w,B as F,p as z,d as X,f as V,a as O}from"./index-b6SL6hsZ.js";import{u as R}from"./useMutation-CvMS9LLC.js";import{S as D}from"./Select-0tL3yPF9.js";import{M as p}from"./Modal-ChpNS6wC.js";import{R as H}from"./config-4dfLyK49.js";const Z=()=>new Date().getMonth()+1,ee=()=>new Date().getFullYear(),K=1e7,E="10.000.000",T=s=>{const o=typeof s=="string"?s.replace(/\D/g,""):s.toString();return o?parseInt(o).toLocaleString("id-ID"):""},B=s=>s.replace(/\D/g,""),ae=()=>{const s=new Date,o=new Date(s.getFullYear(),s.getMonth(),1),g=s.getDate(),u=o.getDay();return Math.ceil((g+u)/7)};function de(){const s=q(),o=A(),[g,u]=n.useState(!1),[j,b]=n.useState(!1),[f,r]=n.useState({open:!1,message:""}),[l,x]=n.useState(""),[i,M]=n.useState(Z().toString()),[d]=n.useState(ee().toString()),[c,h]=n.useState(ae().toString()),[t,y]=n.useState(""),{data:S,isLoading:Q}=k({queryKey:["users"],queryFn:V.getAll}),{data:N}=k({queryKey:["settings",i,d],queryFn:()=>O.getSettings(parseInt(i),parseInt(d)),staleTime:300*1e3}),{data:I}=k({queryKey:["studentsData",i,d],queryFn:()=>O.getStudents(parseInt(i),parseInt(d)),enabled:!!l}),W=a=>{if(!I||!l)return!1;const v=I.find(P=>P.id.toString()===l);if(!v)return!1;const J=`m${a}`;return(v[J]||0)>0},_=G(parseInt(d),parseInt(i)-1),m=Array.from({length:_},(a,v)=>v+1).map(a=>({label:`Minggu ${a}`,value:a.toString(),disabled:W(a)})).filter(a=>!a.disabled);n.useEffect(()=>{S&&S.length>0&&!l&&x(S[0].id.toString())},[S,l]),n.useEffect(()=>{m.length>0?m.find(a=>a.value===c)||h(m[0].value):h("-"),N?.weeklyFee&&y(N.weeklyFee.toString())},[N?.weeklyFee,i,d,I,l,m,c]);const C=R({mutationFn:async()=>z.store({user_id:parseInt(l),bulan:parseInt(i),tahun:parseInt(d),minggu_ke:parseInt(c),nominal:parseInt(t)}),onSuccess:()=>{o.invalidateQueries({queryKey:["students"]}),o.invalidateQueries({queryKey:["dashboardStats"]}),o.invalidateQueries({queryKey:["arrears"]}),u(!1),b(!0)},onError:a=>{u(!1),r({open:!0,message:a.message||"Terjadi kesalahan saat menyimpan data. Silakan coba lagi."})}}),Y=()=>{if(!l||!t){r({open:!0,message:"Lengkapi semua field!"});return}if((!c||c==="-")&&m.length===0){r({open:!0,message:"Mahasiswa ini sudah lunas untuk bulan ini."});return}const a=parseInt(t);if(a>K){r({open:!0,message:`Nominal melebihi batas maksimum. Maksimum input yang diizinkan adalah Rp ${E}. Silakan masukkan nominal yang lebih kecil.`});return}if(a<=0){r({open:!0,message:"Nominal harus lebih dari Rp 0. Silakan masukkan nominal yang valid."});return}u(!0)},$=[{label:"Januari",value:"1"},{label:"Februari",value:"2"},{label:"Maret",value:"3"},{label:"April",value:"4"},{label:"Mei",value:"5"},{label:"Juni",value:"6"},{label:"Juli",value:"7"},{label:"Agustus",value:"8"},{label:"September",value:"9"},{label:"Oktober",value:"10"},{label:"November",value:"11"},{label:"Desember",value:"12"}];return e.jsxs("div",{className:"p-4 md:p-6 bg-background min-h-screen animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>s("/"),className:"w-10 h-10 bg-card rounded-xl shadow-sm border border-border flex items-center justify-center text-muted-foreground active:scale-95 transition-transform",children:e.jsx(L,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Input Iuran"})]}),Q?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"bg-card p-6 rounded-3xl shadow-sm space-y-4 border border-border",children:[e.jsx(D,{label:"Nama Mahasiswa",value:l,onChange:a=>x(a.target.value),options:S?.map(a=>({label:a.nama,value:a.id.toString()}))||[]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(D,{label:"Bulan",value:i,onChange:a=>M(a.target.value),options:$}),e.jsx(D,{label:"Minggu Ke",value:c,onChange:a=>h(a.target.value),options:m.length>0?m:[{label:"Lunas Semua",value:"-"}],disabled:m.length===0})]}),e.jsx(w,{label:"Nominal (Rp)",type:"text",inputMode:"numeric",value:T(t),onChange:a=>y(B(a.target.value)),placeholder:"10.000"}),e.jsx(F,{onClick:Y,variant:"success",className:"w-full",isLoading:C.isPending,children:"Simpan Iuran"})]}),e.jsx(p,{isOpen:g,onClose:()=>u(!1),onConfirm:()=>C.mutate(),title:"Konfirmasi",description:"Simpan data iuran ke sistem?",type:"confirm",confirmLabel:C.isPending?"Menyimpan...":"Ya, Simpan"}),e.jsx(p,{isOpen:j,onClose:()=>{b(!1),s("/")},title:"Berhasil",description:"Data iuran berhasil disimpan!",type:"success"}),e.jsx(p,{isOpen:f.open,onClose:()=>r({open:!1,message:""}),title:"Gagal",description:f.message,type:"error"})]})}function ce(){const s=q(),o=A(),[g,u]=n.useState(!1),[j,b]=n.useState(!1),[f,r]=n.useState({open:!1,message:""}),[l,x]=n.useState(""),[i,M]=n.useState(""),{data:d}=k({queryKey:["dashboardStats"],queryFn:O.getStats,staleTime:60*1e3,refetchInterval:H}),c=R({mutationFn:async()=>{const t=new FormData;return t.append("judul",l),t.append("nominal",i),t.append("tanggal",new Date().toISOString().split("T")[0]),X.store(t)},onSuccess:()=>{o.invalidateQueries({queryKey:["transactions"]}),o.invalidateQueries({queryKey:["dashboardStats"]}),u(!1),b(!0)},onError:t=>{u(!1),r({open:!0,message:t.message||"Gagal menyimpan data belanja."})}}),h=()=>{if(!l||!i){r({open:!0,message:"Lengkapi judul dan nominal!"});return}const t=parseInt(i),y=d?.balance||0;if(t>K){r({open:!0,message:`Nominal melebihi batas maksimum. Maksimum input yang diizinkan adalah Rp ${E}. Silakan masukkan nominal yang lebih kecil.`});return}if(t<=0){r({open:!0,message:"Nominal harus lebih dari Rp 0. Silakan masukkan nominal yang valid."});return}if(t>y){r({open:!0,message:`Saldo tidak cukup! Saldo saat ini: Rp ${y.toLocaleString("id-ID")}, nominal belanja: Rp ${t.toLocaleString("id-ID")}.`});return}u(!0)};return e.jsxs("div",{className:"p-4 md:p-6 bg-background min-h-screen animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>s("/"),className:"w-10 h-10 bg-card rounded-xl shadow-sm border border-border flex items-center justify-center text-muted-foreground active:scale-95 transition-transform",children:e.jsx(L,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Input Belanja"})]}),e.jsxs("div",{className:"bg-card p-6 rounded-3xl shadow-sm space-y-4 border border-border",children:[d&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 mb-2",children:[e.jsx("p",{className:"text-xs font-bold text-blue-600 uppercase mb-1",children:"Saldo Tersedia"}),e.jsxs("p",{className:"text-lg font-black text-blue-800",children:["Rp ",(d.balance||0).toLocaleString("id-ID")]})]}),e.jsx(w,{label:"Kebutuhan / Judul",value:l,onChange:t=>x(t.target.value)}),e.jsx(w,{label:"Nominal (Rp)",type:"text",inputMode:"numeric",value:T(i),onChange:t=>M(B(t.target.value)),placeholder:"10.000"}),e.jsx(F,{onClick:h,variant:"danger",className:"w-full",isLoading:c.isPending,children:"Simpan Belanja"})]}),e.jsx(p,{isOpen:g,onClose:()=>u(!1),onConfirm:()=>c.mutate(),title:"Konfirmasi",description:"Simpan data belanja ke sistem?",type:"confirm",confirmLabel:c.isPending?"Menyimpan...":"Ya, Simpan"}),e.jsx(p,{isOpen:j,onClose:()=>{b(!1),s("/")},title:"Berhasil",description:"Data belanja berhasil disimpan!",type:"success"}),e.jsx(p,{isOpen:f.open,onClose:()=>r({open:!1,message:""}),title:"Gagal",description:f.message,type:"error"})]})}export{de as InputInScreen,ce as InputOutScreen};
