import{j as e,l as N,a as A}from"./ui-DF08lGNp.js";import{c as k,r as t}from"./vendor-S3JaNCHW.js";import{u as I}from"./useQuery-BqchELDf.js";import{a as w,I as C,B as D,p as F,e as E,h as Q}from"./index-f97Fh1he.js";import{u as O}from"./useMutation-Ch02fzv6.js";import{S,M as m}from"./Select-CasHswSc.js";const Y=()=>new Date().getMonth()+1,R=()=>new Date().getFullYear(),J=()=>{const l=new Date,o=new Date(l.getFullYear(),l.getMonth(),1),p=l.getDate(),n=o.getDay();return Math.ceil((p+n)/7)};function $(){const l=k(),o=w(),[p,n]=t.useState(!1),[j,g]=t.useState(!1),[b,i]=t.useState({open:!1,message:""}),[r,x]=t.useState(""),[u,y]=t.useState(Y().toString()),[c,h]=t.useState(R().toString()),[v,a]=t.useState(J().toString()),[d,L]=t.useState("10000"),{data:f,isLoading:q}=I({queryKey:["users"],queryFn:Q.getAll});t.useEffect(()=>{f&&f.length>0&&!r&&x(f[0].id.toString())},[f,r]);const M=O({mutationFn:async()=>F.store({user_id:parseInt(r),bulan:parseInt(u),tahun:parseInt(c),minggu_ke:parseInt(v),nominal:parseInt(d)}),onSuccess:()=>{o.invalidateQueries({queryKey:["students"]}),o.invalidateQueries({queryKey:["dashboardStats"]}),o.invalidateQueries({queryKey:["arrears"]}),n(!1),g(!0)},onError:s=>{n(!1),i({open:!0,message:s.message||"Terjadi kesalahan saat menyimpan data. Silakan coba lagi."})}}),K=()=>{if(!r||!d){i({open:!0,message:"Lengkapi semua field!"});return}n(!0)},B=[{label:"Januari",value:"1"},{label:"Februari",value:"2"},{label:"Maret",value:"3"},{label:"April",value:"4"},{label:"Mei",value:"5"},{label:"Juni",value:"6"},{label:"Juli",value:"7"},{label:"Agustus",value:"8"},{label:"September",value:"9"},{label:"Oktober",value:"10"},{label:"November",value:"11"},{label:"Desember",value:"12"}];return e.jsxs("div",{className:"p-4 md:p-6 bg-background min-h-screen animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>l("/"),className:"w-10 h-10 bg-card rounded-xl shadow-sm border border-border flex items-center justify-center text-muted-foreground active:scale-95 transition-transform",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Input Iuran"})]}),q?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(A,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"bg-card p-6 rounded-3xl shadow-sm space-y-4 border border-border",children:[e.jsx(S,{label:"Nama Mahasiswa",value:r,onChange:s=>x(s.target.value),options:f?.map(s=>({label:s.nama,value:s.id.toString()}))||[]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(S,{label:"Bulan",value:u,onChange:s=>y(s.target.value),options:B}),e.jsx(S,{label:"Tahun",value:c,onChange:s=>h(s.target.value),options:[{label:"2024",value:"2024"},{label:"2025",value:"2025"},{label:"2026",value:"2026"}]})]}),e.jsx(S,{label:"Minggu Ke",value:v,onChange:s=>a(s.target.value),options:[{label:"Minggu 1",value:"1"},{label:"Minggu 2",value:"2"},{label:"Minggu 3",value:"3"},{label:"Minggu 4",value:"4"},{label:"Minggu 5",value:"5"}]}),e.jsx(C,{label:"Nominal (Rp)",type:"number",value:d,onChange:s=>L(s.target.value),placeholder:"10000"}),e.jsx(D,{onClick:K,variant:"success",className:"w-full",isLoading:M.isPending,children:"Simpan Iuran"})]}),e.jsx(m,{isOpen:p,onClose:()=>n(!1),onConfirm:()=>M.mutate(),title:"Konfirmasi",description:"Simpan data iuran ke sistem?",type:"confirm",confirmLabel:M.isPending?"Menyimpan...":"Ya, Simpan"}),e.jsx(m,{isOpen:j,onClose:()=>{g(!1),l("/")},title:"Berhasil",description:"Data iuran berhasil disimpan!",type:"success"}),e.jsx(m,{isOpen:b.open,onClose:()=>i({open:!1,message:""}),title:"Gagal",description:b.message,type:"error"})]})}function z(){const l=k(),o=w(),[p,n]=t.useState(!1),[j,g]=t.useState(!1),[b,i]=t.useState({open:!1,message:""}),[r,x]=t.useState(""),[u,y]=t.useState(""),{data:c}=I({queryKey:["dashboardStats"],queryFn:async()=>(await fetch("http://127.0.0.1:8000/api/dashboard/stats",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Accept:"application/json"}})).json()}),h=O({mutationFn:async()=>{const a=new FormData;return a.append("judul",r),a.append("nominal",u),a.append("tanggal",new Date().toISOString().split("T")[0]),E.store(a)},onSuccess:()=>{o.invalidateQueries({queryKey:["transactions"]}),o.invalidateQueries({queryKey:["dashboardStats"]}),n(!1),g(!0)},onError:a=>{n(!1),i({open:!0,message:a.message||"Gagal menyimpan data belanja."})}}),v=()=>{if(!r||!u){i({open:!0,message:"Lengkapi judul dan nominal!"});return}const a=parseInt(u),d=c?.balance||0;if(a>d){i({open:!0,message:`Saldo tidak cukup! Saldo saat ini: Rp ${d.toLocaleString("id-ID")}, nominal belanja: Rp ${a.toLocaleString("id-ID")}.`});return}n(!0)};return e.jsxs("div",{className:"p-4 md:p-6 bg-background min-h-screen animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>l("/"),className:"w-10 h-10 bg-card rounded-xl shadow-sm border border-border flex items-center justify-center text-muted-foreground active:scale-95 transition-transform",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Input Belanja"})]}),e.jsxs("div",{className:"bg-card p-6 rounded-3xl shadow-sm space-y-4 border border-border",children:[c&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 mb-2",children:[e.jsx("p",{className:"text-xs font-bold text-blue-600 uppercase mb-1",children:"Saldo Tersedia"}),e.jsxs("p",{className:"text-lg font-black text-blue-800",children:["Rp ",(c.balance||0).toLocaleString("id-ID")]})]}),e.jsx(C,{label:"Kebutuhan / Judul",value:r,onChange:a=>x(a.target.value)}),e.jsx(C,{label:"Nominal (Rp)",type:"number",value:u,onChange:a=>y(a.target.value)}),e.jsx(D,{onClick:v,variant:"danger",className:"w-full",isLoading:h.isPending,children:"Simpan Belanja"})]}),e.jsx(m,{isOpen:p,onClose:()=>n(!1),onConfirm:()=>h.mutate(),title:"Konfirmasi",description:"Simpan data belanja ke sistem?",type:"confirm",confirmLabel:h.isPending?"Menyimpan...":"Ya, Simpan"}),e.jsx(m,{isOpen:j,onClose:()=>{g(!1),l("/")},title:"Berhasil",description:"Data belanja berhasil disimpan!",type:"success"}),e.jsx(m,{isOpen:b.open,onClose:()=>i({open:!1,message:""}),title:"Gagal",description:b.message,type:"error"})]})}export{$ as InputInScreen,z as InputOutScreen};
