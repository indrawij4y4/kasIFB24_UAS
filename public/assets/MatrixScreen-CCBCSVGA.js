import{j as e,l as Y,n as B,a as K,o as Q,p as M,F as U,q as W,h as C,r as P,i as G}from"./ui-DF08lGNp.js";import{c as H,r as c}from"./vendor-S3JaNCHW.js";import{u as _}from"./useQuery-DuxVUDsr.js";import{u as V}from"./useMutation-BLnDG93L.js";import{u as X,g as Z,c as s,d as ee,b as A}from"./index-CdnzfiEJ.js";import{S as F,M as I}from"./Select-CKwvDmYb.js";const re=new Date().getMonth()+1,L=new Date().getFullYear(),te=(x,g,o)=>{const l=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"][g-1];return x===1?`1-7 ${l}`:x===2?`8-14 ${l}`:x===3?`15-21 ${l}`:x===4?`22-28 ${l}`:`29-End ${l}`};function ce(){const x=H(),{user:g}=X(),[o,v]=c.useState(re.toString()),[l,T]=c.useState(L.toString()),[h,R]=c.useState(""),[b,N]=c.useState("all"),[f,j]=c.useState(null),[z,y]=c.useState(!1),m=Z(parseInt(l),parseInt(o)-1),{data:d,isLoading:D}=_({queryKey:["students",o,l],queryFn:()=>A.getStudents(parseInt(o),parseInt(l)),staleTime:300*1e3}),{data:i}=_({queryKey:["settings",o,l],queryFn:()=>A.getSettings(parseInt(o),parseInt(l)),staleTime:300*1e3}),J=d&&d.length>0&&d.some(r=>(r.m1||0)+(r.m2||0)+(r.m3||0)+(r.m4||0)+(r.m5||0)>0),$=r=>i?r>=i.weeklyFee?"paid":r>0?"pending":"unpaid":"pending",w=V({mutationFn:r=>ee.resetPassword(r),onSuccess:()=>{j(null),y(!0)},onError:()=>{alert("Gagal mereset password")}}),q=(r,a,t)=>{r.stopPropagation(),j({isOpen:!0,id:a,name:t})},k=c.useMemo(()=>d?d.filter(r=>{const a=(r.name||"").toLowerCase().includes(h.toLowerCase())||r.nim.includes(h);if(b==="all"||!i)return a;const t=i.weeklyFee,u=r.m1<t||r.m2<t||r.m3<t||r.m4<t||m===5&&r.m5<t;return a&&u}):[],[d,h,b,i,m]),n=c.useMemo(()=>{if(!d||!i)return{total:0,fullyPaid:0,hasArrears:0};const r=i.weeklyFee;let a=0,t=0;return d.forEach(u=>{u.m1>=r&&u.m2>=r&&u.m3>=r&&u.m4>=r&&(m<5||u.m5>=r)?a++:t++}),{total:d.length,fullyPaid:a,hasArrears:t}},[d,i,m]),p=(r,a)=>{if(!i)return e.jsx("span",{className:"text-slate-300",children:"-"});if(a===5&&m<5)return e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-200 mx-auto"});const t=$(r);return t==="paid"?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-emerald-100 dark:bg-emerald-900/20 flex items-center justify-center text-emerald-600 dark:text-emerald-400 transition-all hover:scale-110 cursor-pointer",children:e.jsx(C,{className:"w-3.5 h-3.5"})})}):t==="pending"?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-100 dark:bg-amber-900/20 flex items-center justify-center text-amber-600 dark:text-amber-400 transition-all hover:scale-110 cursor-pointer",children:e.jsx(G,{className:"w-3.5 h-3.5"})})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted flex items-center justify-center text-muted-foreground transition-all hover:bg-muted/80 hover:text-foreground cursor-pointer",children:e.jsx(P,{className:"w-4 h-4"})})})},S=[{label:"Januari",value:"1"},{label:"Februari",value:"2"},{label:"Maret",value:"3"},{label:"April",value:"4"},{label:"Mei",value:"5"},{label:"Juni",value:"6"},{label:"Juli",value:"7"},{label:"Agustus",value:"8"},{label:"September",value:"9"},{label:"Oktober",value:"10"},{label:"November",value:"11"},{label:"Desember",value:"12"}],E=Array.from({length:5},(r,a)=>{const t=L-2+a;return{label:t.toString(),value:t.toString()}}),O=S[parseInt(o)-1]?.label||"Unknown";return e.jsxs("div",{className:"p-4 md:p-8 bg-background min-h-screen animate-fadeIn pb-32 font-sans",children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx("button",{onClick:()=>x("/"),className:"w-12 h-12 bg-card rounded-2xl shadow-sm border border-border flex items-center justify-center text-muted-foreground active:scale-95 transition-all hover:border-blue-200 hover:text-blue-500 hover:shadow-md group",children:e.jsx(Y,{className:"w-6 h-6 group-hover:-translate-x-0.5 transition-transform"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-extrabold text-foreground tracking-tight",children:"Matriks Iuran"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Monitor status pembayaran anggota"})]})]}),e.jsxs("div",{className:"bg-card p-2 rounded-2xl shadow-sm border border-border flex items-center gap-3 w-full md:w-auto self-start md:self-auto",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center text-indigo-600 dark:text-indigo-400 shrink-0",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 flex-1 md:min-w-[280px]",children:[e.jsx(F,{label:"",value:o,onChange:r=>v(r.target.value),options:S}),e.jsx(F,{label:"",value:l,onChange:r=>T(r.target.value),options:E})]})]}),D?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsx(K,{className:"w-8 h-8 animate-spin text-primary"})}):J?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"group relative bg-card p-5 rounded-[1.5rem] border border-border shadow-[0_8px_30px_rgb(0,0,0,0.04)] overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[e.jsx("span",{className:"text-xs font-bold uppercase text-muted-foreground mb-1 tracking-wider",children:"Total Anggota"}),e.jsx("span",{className:"text-3xl font-extrabold text-foreground",children:n.total})]}),e.jsx("div",{className:"absolute -right-6 -bottom-6 w-20 h-20 bg-muted rounded-full opacity-10 blur-xl group-hover:opacity-20 transition-opacity"})]}),e.jsxs("div",{className:s("group relative p-5 rounded-[1.5rem] border shadow-[0_8px_30px_rgb(0,0,0,0.04)] overflow-hidden",n.fullyPaid>0?"bg-emerald-50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-900/20":"bg-card border-border"),children:[e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[e.jsx("span",{className:s("text-xs font-bold uppercase mb-1 tracking-wider",n.fullyPaid>0?"text-emerald-600 dark:text-emerald-400":"text-muted-foreground"),children:"Lunas Semua"}),e.jsx("span",{className:s("text-3xl font-extrabold",n.fullyPaid>0?"text-emerald-700 dark:text-emerald-300":"text-foreground"),children:n.fullyPaid})]}),e.jsx("div",{className:s("absolute -right-6 -bottom-6 w-20 h-20 rounded-full blur-xl group-hover:opacity-20 transition-opacity",n.fullyPaid>0?"bg-emerald-500 opacity-10":"bg-muted opacity-10")})]}),e.jsxs("div",{className:s("group relative p-5 rounded-[1.5rem] border shadow-[0_8px_30px_rgb(0,0,0,0.04)] overflow-hidden",n.hasArrears>0?"bg-rose-50 dark:bg-rose-900/10 border-rose-100 dark:border-rose-900/20":"bg-card border-border"),children:[e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[e.jsx("span",{className:s("text-xs font-bold uppercase mb-1 tracking-wider",n.hasArrears>0?"text-rose-600 dark:text-rose-400":"text-muted-foreground"),children:"Ada Tunggakan"}),e.jsx("span",{className:s("text-3xl font-extrabold",n.hasArrears>0?"text-rose-700 dark:text-rose-300":"text-foreground"),children:n.hasArrears})]}),e.jsx("div",{className:s("absolute -right-6 -bottom-6 w-20 h-20 rounded-full blur-xl group-hover:opacity-20 transition-opacity",n.hasArrears>0?"bg-rose-500 opacity-10":"bg-muted opacity-10")})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(M,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Cari nama atau NIM mahasiswa...",value:h,onChange:r=>R(r.target.value),className:"w-full pl-12 pr-4 py-3 bg-card border border-border rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all font-medium text-foreground placeholder:text-muted-foreground"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N("all"),className:s("px-4 py-2 rounded-xl text-xs font-bold transition-all border",b==="all"?"bg-foreground text-background border-foreground":"bg-card text-muted-foreground border-border hover:bg-muted"),children:"Semua"}),e.jsxs("button",{onClick:()=>N("unpaid"),className:s("px-4 py-2 rounded-xl text-xs font-bold transition-all border flex items-center gap-2",b==="unpaid"?"bg-destructive text-destructive-foreground border-destructive":"bg-card text-destructive border-destructive/20 hover:bg-destructive/10"),children:[e.jsx(U,{className:"w-3 h-3"}),"Tunggakan"]})]})]}),e.jsx("div",{className:"bg-card rounded-[1.5rem] border border-border overflow-hidden shadow-sm relative z-0",children:e.jsx("div",{className:"overflow-x-auto custom-scrollbar max-h-[600px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse relative",children:[e.jsx("thead",{className:"sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-muted/95 backdrop-blur-sm border-b border-border shadow-[0_2px_10px_rgba(0,0,0,0.02)]",children:[e.jsx("th",{className:"p-5 text-[10px] font-black uppercase text-muted-foreground sticky left-0 bg-muted z-30 min-w-[180px] shadow-[4px_0_24px_-12px_rgba(0,0,0,0.1)]",children:"Mahasiswa"}),[1,2,3,4,5].map(r=>e.jsx("th",{className:s("p-4 text-center min-w-[80px] group relative",r===5&&m<5&&"opacity-30"),children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-muted-foreground",children:["M",r]}),e.jsx("span",{className:"hidden md:inline-block text-[9px] font-medium text-muted-foreground mt-0.5 whitespace-nowrap bg-background/50 px-1.5 py-0.5 rounded",children:te(r,parseInt(o))})]})},r))]})}),e.jsx("tbody",{className:"text-xs font-bold",children:k.length>0?k.map((r,a)=>e.jsxs("tr",{className:s("border-b border-border last:border-0 transition-colors group",a%2===0?"bg-card":"bg-muted/30","hover:!bg-primary/5"),children:[e.jsx("td",{className:s("p-4 text-foreground sticky left-0 z-20 border-r border-border shadow-[4px_0_24px_-12px_rgba(0,0,0,0.05)] transition-colors","bg-card group-hover:bg-card"),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate font-bold text-foreground",children:r.name}),g?.role==="admin"&&e.jsx("button",{onClick:t=>q(t,r.id,r.name||r.nim),className:"p-1.5 rounded-lg text-muted-foreground hover:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-900/20 transition-all opacity-100 md:opacity-0 md:group-hover:opacity-100",title:"Reset Password",children:e.jsx(W,{className:"w-3.5 h-3.5"})})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium group-hover:text-primary transition-colors",children:r.nim})]})}),e.jsx("td",{className:"p-4 text-center",children:p(r.m1,1)}),e.jsx("td",{className:"p-4 text-center",children:p(r.m2,2)}),e.jsx("td",{className:"p-4 text-center",children:p(r.m3,3)}),e.jsx("td",{className:"p-4 text-center",children:p(r.m4,4)}),e.jsx("td",{className:s("p-4 text-center",m<5&&"opacity-30"),children:p(r.m5,5)})]},r.nim)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-12 text-center text-muted-foreground",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(M,{className:"w-8 h-8 opacity-20"}),e.jsx("p",{className:"text-sm font-medium",children:"Tidak ada data mahasiswa ditemukan"})]})})})})]})})}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-6 mt-4 opacity-70",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-100 dark:bg-emerald-900/40 flex items-center justify-center text-emerald-600 dark:text-emerald-400",children:e.jsx(C,{className:"w-2.5 h-2.5"})}),e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase",children:"Lunas"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400 dark:text-slate-500",children:e.jsx(P,{className:"w-2.5 h-2.5"})}),e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase",children:"Belum Bayar"})]})]})]}):e.jsxs("div",{className:"bg-card rounded-[2rem] border border-dashed border-border p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-amber-50 dark:bg-amber-900/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Q,{className:"w-10 h-10 text-amber-400"})}),e.jsx("h3",{className:"text-xl font-bold text-foreground mb-2",children:"Data Belum Tersedia"}),e.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto mb-6",children:["Periode ",e.jsxs("span",{className:"font-semibold text-foreground",children:[O," ",l]})," belum memiliki data iuran. Silakan pilih periode lain."]})]})]}),e.jsx(I,{isOpen:!!f,onClose:()=>j(null),onConfirm:()=>f&&w.mutate(f.id),title:"Reset Password?",description:`Apakah Anda yakin ingin mereset password untuk "${f?.name}" menjadi NIM? Tindakan ini tidak dapat dibatalkan.`,type:"confirm",confirmLabel:w.isPending?"Mereset...":"Ya, Reset Password"}),e.jsx(I,{isOpen:z,onClose:()=>y(!1),title:"Password Direset",description:"Password mahasiswa telah berhasil dikembalikan ke default (NIM).",type:"success"})]})}export{ce as MatrixScreen};
