import{j as e,a as ae,n as A,W as T,f as se,g as _,s as v,R as I,h as te,o as re}from"./ui-DF08lGNp.js";import{r as d}from"./vendor-S3JaNCHW.js";import{u as p}from"./useQuery-BqchELDf.js";import{u as ne,a as le,c as h,b as g,p as Q,e as de}from"./index-f97Fh1he.js";import{u as y}from"./useMutation-Ch02fzv6.js";import{S as R,M as b}from"./Select-CasHswSc.js";const ie=new Date().getMonth()+1,P=new Date().getFullYear();function he(){const{user:F}=ne(),f=F?.role==="admin",s=le(),[c,k]=d.useState("income"),[r,O]=d.useState(ie.toString()),[n,B]=d.useState(P.toString()),[E,m]=d.useState(!1),[H,N]=d.useState(!1),[U,j]=d.useState(!1),[l,o]=d.useState(null),{data:u,isLoading:Y}=p({queryKey:["transactions",r,n],queryFn:()=>g.getTransactions(parseInt(r),parseInt(n)),staleTime:300*1e3}),{data:w,isLoading:z}=p({queryKey:["students",r,n],queryFn:()=>g.getStudents(parseInt(r),parseInt(n)),staleTime:300*1e3}),{data:S,isLoading:$}=p({queryKey:["stats"],queryFn:g.getStats,staleTime:300*1e3}),{data:x,isLoading:G}=p({queryKey:["incomeList",r,n],queryFn:()=>Q.getList(parseInt(r),parseInt(n)),staleTime:300*1e3}),L=y({mutationFn:g.resetAllData,onSuccess:()=>{s.invalidateQueries({queryKey:["dashboardStats"]}),s.invalidateQueries({queryKey:["stats"]}),s.invalidateQueries({queryKey:["transactions"]}),s.invalidateQueries({queryKey:["students"]}),s.invalidateQueries({queryKey:["arrears"]}),s.invalidateQueries({queryKey:["leaderboard"]}),s.invalidateQueries({queryKey:["incomeList"]}),m(!1),N(!0)},onError:a=>{alert("Gagal menghapus data: "+(a.message||"Unknown error")),m(!1)}}),D=y({mutationFn:a=>Q.delete(a),onSuccess:()=>{s.invalidateQueries({queryKey:["incomeList"]}),s.invalidateQueries({queryKey:["students"]}),s.invalidateQueries({queryKey:["stats"]}),s.invalidateQueries({queryKey:["dashboardStats"]}),s.invalidateQueries({queryKey:["arrears"]}),o(null),j(!0)},onError:a=>{alert("Gagal menghapus pemasukan: "+(a.message||"Unknown error"))}}),q=y({mutationFn:a=>de.delete(a),onSuccess:()=>{s.invalidateQueries({queryKey:["transactions"]}),s.invalidateQueries({queryKey:["stats"]}),s.invalidateQueries({queryKey:["dashboardStats"]}),o(null),j(!0)},onError:a=>{alert("Gagal menghapus pengeluaran: "+(a.message||"Unknown error"))}}),J=()=>{l&&(l.type==="income"?D.mutate(l.id):q.mutate(l.id))},W=Y||$||z||G,C=[{label:"Januari",value:"1"},{label:"Februari",value:"2"},{label:"Maret",value:"3"},{label:"April",value:"4"},{label:"Mei",value:"5"},{label:"Juni",value:"6"},{label:"Juli",value:"7"},{label:"Agustus",value:"8"},{label:"September",value:"9"},{label:"Oktober",value:"10"},{label:"November",value:"11"},{label:"Desember",value:"12"}],Z=Array.from({length:5},(a,t)=>{const i=P-2+t;return{label:i.toString(),value:i.toString()}}),V=C[parseInt(r)-1]?.label||"Unknown";if(W||!u||!S||!w)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ae,{className:"w-8 h-8 animate-spin text-primary"})});const M=w.reduce((a,t)=>a+(t.m1||0)+(t.m2||0)+(t.m3||0)+(t.m4||0)+(t.m5||0),0),K=u.filter(a=>a.type==="expense").reduce((a,t)=>a+t.amount,0),X=S.balance,ee=M>0||K>0;return e.jsxs("div",{className:"p-4 md:p-8 bg-background min-h-screen animate-fadeIn pb-32 font-sans",children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex flex-col gap-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-extrabold text-foreground tracking-tight",children:"Laporan Keuangan"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Ringkasan lengkap aktivitas keuangan kas."})]}),e.jsxs("div",{className:"bg-card p-2 rounded-2xl shadow-sm border border-border flex items-center gap-3 w-full md:w-auto",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center text-indigo-600 dark:text-indigo-400 shrink-0",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 flex-1 md:min-w-[280px]",children:[e.jsx(R,{label:"",value:r,onChange:a=>O(a.target.value),options:C}),e.jsx(R,{label:"",value:n,onChange:a=>B(a.target.value),options:Z})]})]})]})}),ee?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"group relative p-6 rounded-[2rem] bg-card border border-border shadow-[0_8px_30px_rgb(0,0,0,0.04)] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-2xl flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 stroke-[2px]"})}),e.jsx("span",{className:"text-[10px] font-bold px-2 py-1 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full",children:"Total Kas"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-bold uppercase tracking-wider mb-2",children:"Saldo Akhir"}),e.jsxs("h3",{className:"text-2xl font-extrabold text-foreground",children:["Rp ",X.toLocaleString("id-ID")]})]}),e.jsx("div",{className:"absolute -right-6 -bottom-6 w-24 h-24 bg-blue-500 rounded-full opacity-5 blur-2xl transition-opacity group-hover:opacity-10"})]}),e.jsxs("div",{className:"group relative p-6 rounded-[2rem] bg-card border border-border shadow-[0_8px_30px_rgb(0,0,0,0.04)] overflow-hidden",children:[e.jsx("div",{className:"flex justify-between items-start mb-6",children:e.jsx("div",{className:"w-12 h-12 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 rounded-2xl flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 stroke-[2px]"})})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-bold uppercase tracking-wider mb-2",children:"Total Pemasukan"}),e.jsxs("h3",{className:"text-2xl font-extrabold text-emerald-600 dark:text-emerald-400",children:["+Rp ",M.toLocaleString("id-ID")]})]}),e.jsx("div",{className:"absolute -right-6 -bottom-6 w-24 h-24 bg-emerald-500 rounded-full opacity-5 blur-2xl transition-opacity group-hover:opacity-10"})]}),e.jsxs("div",{className:"group relative p-6 rounded-[2rem] bg-card border border-border shadow-[0_8px_30px_rgb(0,0,0,0.04)] overflow-hidden",children:[e.jsx("div",{className:"flex justify-between items-start mb-6",children:e.jsx("div",{className:"w-12 h-12 bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 rounded-2xl flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 stroke-[2px]"})})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-muted-foreground text-xs font-bold uppercase tracking-wider mb-2",children:"Total Pengeluaran"}),e.jsxs("h3",{className:"text-2xl font-extrabold text-rose-600 dark:text-rose-400",children:["-Rp ",K.toLocaleString("id-ID")]})]}),e.jsx("div",{className:"absolute -right-6 -bottom-6 w-24 h-24 bg-rose-500 rounded-full opacity-5 blur-2xl transition-opacity group-hover:opacity-10"})]})]}),e.jsxs("div",{className:"flex md:hidden bg-card p-1 rounded-xl shadow-sm border border-border sticky top-0 z-20",children:[e.jsx("button",{onClick:()=>k("income"),className:h("flex-1 py-2.5 text-xs font-bold rounded-lg transition-all",c==="income"?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 shadow-sm":"text-muted-foreground hover:bg-muted"),children:"Pemasukan"}),e.jsx("button",{onClick:()=>k("expense"),className:h("flex-1 py-2.5 text-xs font-bold rounded-lg transition-all",c==="expense"?"bg-rose-50 dark:bg-rose-900/20 text-rose-700 dark:text-rose-400 shadow-sm":"text-muted-foreground hover:bg-muted"),children:"Pengeluaran"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs("div",{className:h("space-y-4",c==="expense"?"hidden md:block":"block"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-foreground flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]"}),"Rincian Pemasukan"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[x?.length||0," transaksi"]})]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-1",children:x&&x.length>0?x.map(a=>{let t="-";if(a.tanggal)try{const i=new Date(a.tanggal);isNaN(i.getTime())||(t=i.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}))}catch{t=a.tanggal}return e.jsxs("div",{className:"group flex justify-between items-center bg-card p-4 rounded-[1.5rem] border border-border shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 flex items-center justify-center text-emerald-600 dark:text-emerald-400 group-hover:scale-110 transition-transform",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-foreground text-sm mb-0.5",children:a.nama}),e.jsxs("p",{className:"text-xs text-muted-foreground font-medium",children:["Minggu ",a.minggu_ke," • ",t]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-black text-emerald-600 dark:text-emerald-400 text-sm",children:["+Rp ",a.nominal.toLocaleString("id-ID")]})}),f&&e.jsx("button",{onClick:()=>o({isOpen:!0,type:"income",id:a.id,title:`${a.nama} - Minggu ${a.minggu_ke}`}),className:"opacity-100 md:opacity-0 md:group-hover:opacity-100 p-2 rounded-lg bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/40 transition-all",title:"Hapus pemasukan",children:e.jsx(v,{className:"w-4 h-4"})})]})]},a.id)}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 px-6 text-center bg-muted/30 rounded-[1.5rem] min-h-[100px]",children:[e.jsx("div",{className:"w-14 h-14 bg-card rounded-full flex items-center justify-center mb-3 shadow-sm",children:e.jsx(I,{className:"w-6 h-6 text-muted-foreground/50"})}),e.jsx("p",{className:"font-bold text-muted-foreground text-sm",children:"Belum ada pemasukan"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1 max-w-[200px]",children:"Tidak ada catatan transaksi masuk untuk periode ini."})]})})]}),e.jsxs("div",{className:h("space-y-4",c==="income"?"hidden md:block":"block"),children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h4",{className:"text-sm font-bold text-foreground flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-rose-500 shadow-[0_0_8px_rgba(244,63,94,0.4)]"}),"Rincian Pengeluaran"]})}),e.jsxs("div",{className:"space-y-3",children:[u.filter(a=>a.type==="expense").map(a=>e.jsxs("div",{className:"group flex justify-between items-center bg-card p-5 rounded-[1.5rem] border border-border shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-rose-50 dark:bg-rose-900/20 flex items-center justify-center text-rose-600 dark:text-rose-400 group-hover:scale-110 transition-transform",children:e.jsx(_,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-foreground text-sm mb-0.5",children:a.title}),e.jsxs("p",{className:"text-xs text-muted-foreground font-medium",children:[a.date," • ",a.category]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-black text-rose-600 dark:text-rose-400 text-sm mb-1",children:["-Rp ",a.amount.toLocaleString("id-ID")]}),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-[10px] text-emerald-700 dark:text-emerald-300 font-bold bg-emerald-50 dark:bg-emerald-900/40 px-2.5 py-1 rounded-full w-fit ml-auto",children:[e.jsx(te,{className:"w-3 h-3"}),e.jsx("span",{children:"Selesai"})]})]}),f&&e.jsx("button",{onClick:()=>o({isOpen:!0,type:"expense",id:a.id,title:a.title}),className:"opacity-100 md:opacity-0 md:group-hover:opacity-100 p-2 rounded-lg bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/40 transition-all",title:"Hapus pengeluaran",children:e.jsx(v,{className:"w-4 h-4"})})]})]},a.id)),u.filter(a=>a.type==="expense").length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 px-6 text-center bg-muted/30 rounded-[1.5rem] min-h-[100px]",children:[e.jsx("div",{className:"w-14 h-14 bg-card rounded-full flex items-center justify-center mb-3 shadow-sm",children:e.jsx(I,{className:"w-6 h-6 text-muted-foreground/50"})}),e.jsx("p",{className:"font-bold text-muted-foreground text-sm",children:"Belum ada pengeluaran"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1 max-w-[200px]",children:"Tidak ada catatan transaksi keluar untuk periode ini."})]})]})]})]})]}):e.jsxs("div",{className:"bg-card rounded-[2rem] border border-dashed border-border p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(A,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-bold text-foreground mb-2",children:"Belum Ada Data"}),e.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto mb-6",children:["Belum ada transaksi yang tercatat untuk periode ",e.jsxs("span",{className:"font-semibold text-foreground",children:[V," ",n]}),". Silakan pilih periode lain atau hubungi admin."]})]}),f&&e.jsx("div",{className:"bg-rose-50 dark:bg-rose-900/10 p-6 rounded-3xl border border-rose-100 dark:border-rose-900/30 mt-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-rose-100 dark:bg-rose-900/40 rounded-2xl flex items-center justify-center text-rose-600 dark:text-rose-400 shrink-0",children:e.jsx(re,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-rose-800 dark:text-rose-300 mb-1",children:"Zona Bahaya"}),e.jsx("p",{className:"text-xs text-rose-600 dark:text-rose-400 mb-4",children:"Tindakan di bawah ini bersifat permanen dan tidak dapat dibatalkan."}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 bg-rose-600 text-white px-4 py-2.5 rounded-xl text-sm font-bold hover:bg-rose-700 active:scale-95 transition-all",children:[e.jsx(v,{className:"w-4 h-4"}),"Reset Semua Data"]})]})]})})]}),e.jsx(b,{isOpen:E,onClose:()=>m(!1),onConfirm:()=>L.mutate(),title:"Hapus Semua Data?",description:"Tindakan ini akan menghapus SEMUA data pemasukan dan pengeluaran dari sistem. Data yang sudah dihapus tidak dapat dikembalikan. Apakah Anda yakin?",type:"confirm",confirmLabel:L.isPending?"Menghapus...":"Ya, Hapus Semua"}),e.jsx(b,{isOpen:!!l,onClose:()=>o(null),onConfirm:J,title:`Hapus ${l?.type==="income"?"Pemasukan":"Pengeluaran"}?`,description:`Apakah Anda yakin ingin menghapus "${l?.title}"? Tindakan ini tidak dapat dibatalkan.`,type:"confirm",confirmLabel:D.isPending||q.isPending?"Menghapus...":"Ya, Hapus"}),e.jsx(b,{isOpen:H,onClose:()=>N(!1),title:"Data Berhasil Dihapus",description:"Semua data pemasukan dan pengeluaran telah dihapus dari sistem.",type:"success"}),e.jsx(b,{isOpen:U,onClose:()=>j(!1),title:"Berhasil Dihapus",description:"Item telah berhasil dihapus dari sistem.",type:"success"})]})}export{he as ReportScreen};
